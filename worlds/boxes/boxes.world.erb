<?xml version="1.0" ?>

<%
  # Boxes benchmark example world
  # SI units (length in meters)

  # default values
  unless defined?(modelCount)
    modelCount = 1  
  end

  unless defined?(collision)
    collision = 1
  end

  unless defined?(dt)
    dt = 0.001
  end

  unless defined?(complex)
    complex = 0
  end

  boxes = modelCount.to_i

  # Geometry
  dx   = 0.1
  dy   = 0.4
  dz   = 0.9

  if complex.to_i == 0
    v0 = [-0.9, 0.4, 0.1]
    w0 = [0.5, 0.0, 0.0]
    gravity = [0, 0, 0]
  else
    v0 = [-2.0, 2.0, 8.0]
    w0 = [0.1, 5.0, 0.1]
    gravity = [0, 0, -9.80]
  end
%>
<sdf version="1.6">
  <world name="default">

    <gravity><%= gravity.join(" ") %></gravity>
    

    <physics type="ignored">
      <max_step_size><%= dt.to_f %></max_step_size>
      <real_time_factor> 0 </real_time_factor>
    </physics>

    <plugin
      filename="gz-sim-physics-system"
      name="gz::sim::systems::Physics">
    </plugin>

    <plugin
      filename="gz-sim-scene-broadcaster-system"
      name="gz::sim::systems::SceneBroadcaster">
    </plugin>

<%
  boxes.times do |i|
    name = "box_" + i.to_s
    y0 = dz * 2 * i
%>
    <model name="<%= name %>">
      <pose>0 <%= y0 %> 0  0 0 0</pose>
      <link name="box_link">
      <inertial>
        <mass>10</mass>
        <inertia>
          <ixx>0.8083333333333335</ixx>
          <iyy>0.6833333333333335</iyy>
          <izz>0.14166666666666672</izz>
          <ixy>0</ixy>
          <ixz>0</ixz>
          <iyz>0</iyz>
        </inertia>
      </inertial>
      <% if collision.to_i == 1 %>
        <collision name="box_collision">
        <geometry>
          <box>
            <size>0.1 0.4 0.9</size>
          </box>
        </geometry>
        </collision>
      <% end %>
      <visual name="box_visual">
          <geometry>
            <box>
              <size>0.1 0.4 0.9</size>
            </box>
          </geometry>
          <material>
            <ambient>0.1 0.1 0.1 1</ambient>
            <diffuse>0.1 0.1 0.1 1</diffuse>
            <specular>0.01 0.01 0.01 1</specular>
          </material>
        </visual>
      </link>  
      <plugin
      filename="gz-sim-set-model-state-system"
      name="gz::sim::systems::SetModelState">
        <model_state>
          <link_state name="box_link">
            <linear_velocity><%= v0.join(" ") %></linear_velocity>
            <angular_velocity><%= w0.join(" ") %></angular_velocity>
          </link_state>
        </model_state>
     </plugin>
    </model>
<%
  end
%>
  </world>
</sdf>